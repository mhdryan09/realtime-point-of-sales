# 4. Logout

## Recap Perubahan

### 1. Membuat Auth Action untuk Logout

**Langkah:**
Membuat server action untuk logout di `src/actions/auth-action.ts`:

```typescript
"use server";

import { createClient } from "@/lib/supabase/server";
import { revalidatePath } from "next/cache";
import { cookies } from "next/headers";
import { redirect } from "next/navigation";

export async function signOut() {
  // connect supabase
  const supabase = await createClient();
  // define cookies
  const cookiesStore = await cookies();

  try {
    await supabase.auth.signOut();
    cookiesStore.delete("user_profile");
    revalidatePath("/", "layout");
  } catch (error) {
    console.error("Error signing out : ", error);
  }
  redirect("/login");
}
```

**Penjelasan:**

- **Server Action**: Menggunakan directive `"use server"` untuk menjalankan fungsi di server
- **Supabase SignOut**: Menghapus session user dari Supabase Auth
- **Cookie Management**: Menghapus cookie `user_profile` yang disimpan saat login
- **Cache Revalidation**: Me-refresh cache layout untuk update UI
- **Error Handling**: Try-catch untuk menangani error saat logout
- **Redirect**: Mengarahkan user kembali ke halaman login

#### **Penjelasan Script Kompleks:**

**1. Async Server Action:**

```typescript
export async function signOut() {
  const supabase = await createClient();
  const cookiesStore = await cookies();
}
```

- `"use server"`: Menandakan fungsi ini berjalan di server, bukan browser
- `await createClient()`: Membuat koneksi Supabase dengan credential server
- `await cookies()`: Mengakses cookies dari request header server

**2. Sequential Logout Process:**

```typescript
try {
  await supabase.auth.signOut();
  cookiesStore.delete("user_profile");
  revalidatePath("/", "layout");
} catch (error) {
  console.error("Error signing out : ", error);
}
```

- `await supabase.auth.signOut()`: Hapus session dari Supabase Auth
- `cookiesStore.delete()`: Hapus cookie profile yang tersimpan di browser
- `revalidatePath("/", "layout")`: Refresh cache Next.js untuk update UI
- Try-catch: Tangkap error tapi tetap lanjut ke redirect

### 2. Integrasi Logout ke Sidebar

**Langkah:**
Menambahkan fungsi logout ke dropdown menu di `src/components/common/app-sidebar.tsx`:

```typescript
import { signOut } from "@/actions/auth-action";

// Di dalam DropdownMenuGroup:
<DropdownMenuItem onClick={() => signOut()}>
  <LogOut />
  Logout
</DropdownMenuItem>
```

**Penjelasan:**

- **Import Server Action**: Import fungsi signOut dari auth-action
- **onClick Handler**: Menjalankan fungsi signOut saat menu diklik
- **Arrow Function**: `() => signOut()` untuk memanggil server action
- **Icon Integration**: Menggunakan LogOut icon dari Lucide React

#### **Penjelasan Script Kompleks:**

**1. Server Action Call dari Client:**

```typescript
<DropdownMenuItem onClick={() => signOut()}>
```

- `onClick`: Event handler yang dijalankan saat user klik menu
- `() => signOut()`: Arrow function yang memanggil server action
- Server action otomatis menangani form submission dan redirect

**2. Component State Management:**

```typescript
import { signOut } from "@/actions/auth-action";
```

- Import server action seperti biasa, Next.js otomatis handle client-server communication
- Tidak perlu state management tambahan karena server action handle semuanya
- User interface otomatis update setelah redirect

---

**Kesimpulan:**
Perubahan ini menambahkan fitur logout yang lengkap dengan pembersihan session Supabase, penghapusan cookie profile, dan redirect otomatis ke halaman login. Sistem logout terintegrasi dengan menu dropdown user di sidebar.

### **Fitur Logout yang Dibuat:**

- **Server-side Logout**: Proses logout aman di server menggunakan server action
- **Session Cleanup**: Hapus session Supabase dan cookie profile
- **Error Handling**: Penanganan error dengan try-catch dan logging
- **UI Integration**: Menu logout terintegrasi di dropdown user profile
- **Auto Redirect**: Otomatis kembali ke halaman login setelah logout

---

_Catatan: Sistem logout ini menggunakan server action Next.js untuk keamanan maksimal dan user experience yang smooth dengan auto redirect._
