# 7. Data Table UI

## Recap Perubahan

### 1. Instalasi ShadCN UI Components

**Langkah:**
Melakukan instalasi beberapa ShadCN UI components untuk data table:

```bash
npx shadcn@latest add table, pagination, select
```

### 2. Membuat DataTable Component

**Langkah:**
Membuat reusable data table component di `src/components/common/data-table.tsx`:

```typescript
import { ReactNode } from "react";
import { Card } from "../ui/card";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "../ui/table";

type DataTableProps = {
  header: string[];
  data: (string | ReactNode)[][];
  isLoading?: boolean;
};

export default function DataTable({ header, data, isLoading }: DataTableProps) {
  return (
    <div className="flex w-full flex-col gap-4">
      <Card className="p-0">
        <Table className="w-full overflow-hidden rounded-lg">
          <TableHeader className="bg-muted sticky top-0 z-10">
            <TableRow>
              {header.map((column) => (
                <TableHead key={`th-${column}`} className="px-6 py-3">
                  {column}
                </TableHead>
              ))}
            </TableRow>
          </TableHeader>

          {/* data */}
          <TableBody>
            {data.map((row, rowIndex) => (
              <TableRow key={`tr-${rowIndex}`}>
                {row.map((column, columnIndex) => (
                  <TableCell
                    key={`tc-${rowIndex}-${columnIndex}`}
                    className="px-6 py-3"
                  >
                    {column}
                  </TableCell>
                ))}
              </TableRow>
            ))}

            {/* data tidak ada dan sudah selesai loading */}
            {data?.length === 0 && !isLoading && (
              <TableRow>
                <TableCell colSpan={header.length} className="h-24 text-center">
                  No Result Data
                </TableCell>
              </TableRow>
            )}

            {/* ketika sedang loading */}
            {isLoading && (
              <TableRow>
                <TableCell colSpan={header.length} className="h-24 text-center">
                  Loading
                </TableCell>
              </TableRow>
            )}
          </TableBody>
        </Table>
      </Card>
    </div>
  );
}
```

**Penjelasan:**

- **Reusable Component**: Component yang bisa digunakan untuk berbagai tabel
- **TypeScript Props**: Typed props untuk header, data, dan loading state
- **Card Wrapper**: Table dibungkus Card untuk styling dan shadow
- **Sticky Header**: Header table tetap terlihat saat scroll dengan `sticky top-0`
- **Loading States**: Handling untuk loading dan empty state
- **Responsive Design**: Table responsive dengan overflow scroll

#### **Penjelasan Script Kompleks:**

**1. TypeScript Type Definition:**

```typescript
type DataTableProps = {
  header: string[];
  data: (string | ReactNode)[][];
  isLoading?: boolean;
};
```

- `header: string[]`: Array string untuk header kolom table
- `data: (string | ReactNode)[][]`: 2D array yang bisa berisi string atau React component
- `isLoading?: boolean`: Optional prop untuk loading state
- **Union Types**: `string | ReactNode` memungkinkan cell berisi text atau component

**2. Dynamic Table Rendering:**

```typescript
{header.map((column) => (
  <TableHead key={`th-${column}`} className="px-6 py-3">
    {column}
  </TableHead>
))}
```

- **Dynamic Headers**: Header dibuat berdasarkan array yang dikirim
- **Unique Keys**: `th-${column}` untuk React key optimization
- **Consistent Spacing**: `px-6 py-3` untuk padding yang sama

**3. Nested Mapping Pattern:**

```typescript
{data.map((row, rowIndex) => (
  <TableRow key={`tr-${rowIndex}`}>
    {row.map((column, columnIndex) => (
      <TableCell key={`tc-${rowIndex}-${columnIndex}`}>
        {column}
      </TableCell>
    ))}
  </TableRow>
))}
```

- **2D Array Mapping**: Outer map untuk rows, inner map untuk columns
- **Compound Keys**: `tc-${rowIndex}-${columnIndex}` untuk unique identification
- **Flexible Content**: Column bisa berisi string atau React component

**4. Conditional Rendering States:**

```typescript
{data?.length === 0 && !isLoading && (
  <TableRow>
    <TableCell colSpan={header.length} className="h-24 text-center">
      No Result Data
    </TableCell>
  </TableRow>
)}
```

- **Optional Chaining**: `data?.length` prevent error jika data null
- **Multiple Conditions**: Empty data DAN tidak loading
- **ColSpan**: `colSpan={header.length}` untuk span semua kolom
- **Conditional UI**: Berbeda message untuk loading vs empty state

### 3. Membuat User Table Constant

**Langkah:**
Membuat constant untuk header table di `src/constants/user-constant.ts`:

```typescript
export const HEADER_TABLE_USER = ["No", "ID", "Name", "Role", "Action"];
```

**Penjelasan:**

- **Centralized Constants**: Header table disimpan di satu tempat
- **Reusable**: Bisa digunakan di berbagai component yang butuh header sama
- **Maintainable**: Mudah diubah kalau ada perubahan struktur table
- **Type Safety**: TypeScript otomatis infer sebagai `string[]`

### 4. Mengintegrasikan DataTable ke User Management

**Langkah:**
Mengupdate user management component untuk menggunakan DataTable di `src/app/(dashboard)/admin/user/_components/user.tsx`:

```typescript
"use client";

import DataTable from "@/components/common/data-table";
import { HEADER_TABLE_USER } from "@/constants/user-constant";
import { useMemo } from "react";

export default function UserManagement() {
  // ... existing query code

  const filteredData = useMemo(() => {
    // mapping untuk baris
    return (users || []).map((user, index) => {
      // mapping untuk column
      return [
        index + 1,
        user.id,
        user.name,
        user.role,
        "", // action
      ];
    });
  }, [users]);

  return (
    <div className="w-full">
      {/* ... existing header code */}

      {/* Table */}
      <DataTable
        header={HEADER_TABLE_USER}
        isLoading={isLoading}
        data={filteredData}
      />
    </div>
  );
}
```

**Perubahan yang dilakukan:**

- ✅ **Import DataTable**: Import component DataTable yang baru dibuat
- ✅ **Import Constant**: Import header table dari constant
- ✅ **Add useMemo**: Hook untuk optimize data transformation
- ✅ **Replace Manual Mapping**: Ganti simple div mapping dengan DataTable
- ✅ **Data Transformation**: Transform user data menjadi format 2D array

#### **Penjelasan Script Kompleks:**

**1. useMemo Hook Optimization:**

```typescript
const filteredData = useMemo(() => {
  return (users || []).map((user, index) => {
    return [
      index + 1,
      user.id,
      user.name,
      user.role,
      "", // action
    ];
  });
}, [users]);
```

- **useMemo**: Hook untuk memoize expensive computations
- **Dependency Array**: `[users]` - hanya recalculate jika users berubah
- **Fallback Array**: `(users || [])` prevent error jika users null
- **Data Transformation**: Transform object array menjadi 2D string array
- **Performance**: Tidak recalculate setiap render, hanya saat users berubah

**2. Data Mapping Pattern:**

```typescript
return [
  index + 1, // No (sequential number)
  user.id, // ID dari database
  user.name, // Name user
  user.role, // Role user
  "", // Action (placeholder untuk future buttons)
];
```

- **Array Position Matching**: Urutan harus sesuai dengan HEADER_TABLE_USER
- **Sequential Numbering**: `index + 1` untuk nomor urut mulai dari 1
- **Direct Property Access**: `user.id`, `user.name`, `user.role`
- **Placeholder**: Empty string untuk kolom action yang belum diimplementasi

**3. Component Integration:**

```typescript
<DataTable
  header={HEADER_TABLE_USER}
  isLoading={isLoading}
  data={filteredData}
/>
```

- **Props Passing**: Pass header, loading state, dan data yang sudah ditransform
- **Constant Usage**: Header dari constant untuk consistency
- **State Forwarding**: `isLoading` dari React Query diteruskan ke DataTable
- **Clean Separation**: Logic di parent, presentation di DataTable

---

**Kesimpulan:**
Perubahan ini menambahkan sistem data table yang reusable dengan ShadCN UI components. User management sekarang menampilkan data dalam format table yang proper dengan loading states, empty states, dan styling yang konsisten dengan design system.

### **Fitur Data Table UI yang Dibuat:**

- **Reusable DataTable Component**: Component table yang bisa digunakan di berbagai halaman
- **ShadCN UI Integration**: Table, Pagination, dan Select components yang sudah pre-styled
- **TypeScript Type Safety**: Full typing untuk props dan data structure
- **Loading & Empty States**: Proper handling untuk loading dan empty data scenarios
- **Responsive Design**: Table responsive dengan horizontal scroll di mobile
- **Performance Optimization**: useMemo untuk prevent unnecessary re-calculations
- **Consistent Styling**: Design system yang konsisten dengan card wrapper dan spacing
- **Accessibility**: Radix UI primitives dengan built-in accessibility features

---

_Catatan: ShadCN UI memberikan components yang sudah optimized untuk accessibility, performance, dan design consistency. DataTable component bisa digunakan untuk semua tabel di aplikasi dengan struktur data yang fleksibel._
